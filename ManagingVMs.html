<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Managing VMs &mdash; Chef 0.9 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Chef 0.9 documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="index.html">Chef 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="managing-vms">
<h1><a class="toc-backref" href="#id5">Managing VMs</a><a class="headerlink" href="#managing-vms" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#managing-vms" id="id5">Managing VMs</a><ul>
<li><a class="reference internal" href="#managing-vms-with-ctl" id="id6">Managing VMs With <tt class="docutils literal"><span class="pre">ctl</span></tt></a><ul>
<li><a class="reference internal" href="#create" id="id7">Create</a></li>
<li><a class="reference internal" href="#clone" id="id8">Clone</a></li>
<li><a class="reference internal" href="#export-import" id="id9">Export/Import</a></li>
<li><a class="reference internal" href="#delete" id="id10">Delete</a></li>
</ul>
</li>
<li><a class="reference internal" href="#managing-vms-manually" id="id11">Managing VMs Manually</a><ul>
<li><a class="reference internal" href="#id1" id="id12">Create</a></li>
<li><a class="reference internal" href="#id2" id="id13">Clone</a></li>
<li><a class="reference internal" href="#id3" id="id14">Export/Import</a></li>
<li><a class="reference internal" href="#id4" id="id15">Delete</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-s2e-vm-image-format" id="id16">The S²E VM Image Format</a><ul>
<li><a class="reference internal" href="#the-s2e-file-name-suffix" id="id17">The <tt class="docutils literal"><span class="pre">.s2e</span></tt> file name suffix</a></li>
<li><a class="reference internal" href="#snapshots" id="id18">Snapshots</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p><strong>Note</strong>: In this document, <tt class="docutils literal"><span class="pre">$S2EDIR</span></tt> denotes the location where all the S²E
related files lie in, as explained in <a class="reference internal" href="BuildingS2E.html"><em>Building the S²E Platform</em></a>. Furthermore, this
document makes extensive use of the <tt class="docutils literal"><span class="pre">$S2EDIR/src/ctl</span></tt> script, and runs it
simply as the <tt class="docutils literal"><span class="pre">ctl</span></tt> command. You may achieve the same effect by</p>
<div class="highlight-python"><div class="highlight"><pre>$ alias ctl=$S2EDIR/src/ctl
</pre></div>
</div>
<p>or by adding a symbolic link from somewhere in your <tt class="docutils literal"><span class="pre">PATH</span></tt> environment.</p>
<div class="section" id="managing-vms-with-ctl">
<h2><a class="toc-backref" href="#id6">Managing VMs With <tt class="docutils literal"><span class="pre">ctl</span></tt></a><a class="headerlink" href="#managing-vms-with-ctl" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create">
<h3><a class="toc-backref" href="#id7">Create</a><a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm create MyBox 7680M
[ OK ] initialise VM
[ OK ] create 7680MiB image
</pre></div>
</div>
<p>The resulting VM should show up in the list of managed VMs:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm list
MyBox
  Size: 7680.0MiB
</pre></div>
</div>
</div>
<div class="section" id="clone">
<span id="clonevms"></span><h3><a class="toc-backref" href="#id8">Clone</a><a class="headerlink" href="#clone" title="Permalink to this headline">¶</a></h3>
<p>Assume we&#8217;ve got the following machine:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm list
MyBox
  Size: 7680.0MiB
  Snapshots:
    ready
    base
    asdföklj
</pre></div>
</div>
<p>Now we may want to split the development on this machine, or just fiddle around
on it and have a &#8220;safe copy&#8221; in case something goes wrong, then we can <em>clone</em>
it:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm clone MyBox MyClonedBox
[ OK ] initialise VM
[ OK ] copy disk image
[ OK ] copy snapshot: ready
[ OK ] copy snapshot: base
[ OK ] copy snapshot: asdfölkj
</pre></div>
</div>
<p>After this, the result is:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm list
MyBox
  Size: 7680.0MiB
  Snapshots:
    ready
    base
    asdföklj
MyClonedBox
  Size: 7680.0MiB
  Snapshots:
    ready
    base
    asdföklj
</pre></div>
</div>
<p>Note that cloning takes both time and disk space. Depending on your tasks,
creating snapshots may be a better solution.</p>
</div>
<div class="section" id="export-import">
<span id="exportimportvms"></span><h3><a class="toc-backref" href="#id9">Export/Import</a><a class="headerlink" href="#export-import" title="Permalink to this headline">¶</a></h3>
<p>To facilitate collaboration, VMs can be packaged:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm export MyBox
[INFO] exporting to /path/to/working/directory/MyBox.tar.gz
[ OK ] package disk image
[ OK ] package snapshot: ready
[ OK ] package snapshot: base
[ OK ] package snapshot: asdfölkj
[ OK ] compress package
[ OK ] clean up
</pre></div>
</div>
<p>The resulting package can then of course be imported again:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm import MyBox.tar.gz AnImportedBox
[ OK ] initialise VM
[ OK ] decompress package
[ OK ] scan package
[ OK ] extract disk image
[ OK ] extract snapshot: ready
[ OK ] extract snapshot: base
[ OK ] extract snapshot: asdfölkj
[ OK ] clean up
</pre></div>
</div>
<p>and should appear in the list of managed VMs:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm list
MyBox
  Size: 7680.0MiB
  Snapshots:
    ready
    base
    asdfölkj
AnImportedBox
  Size: 7680.0MiB
  Snapshots:
    ready
    base
    asdfölkj
</pre></div>
</div>
<p>If you wish to import just a raw image, you can pass the <tt class="docutils literal"><span class="pre">--raw</span></tt> option:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm import --raw /path/to/disk.raw AnImportedBox
[ OK ] initialise VM
[ OK ] copy disk image
</pre></div>
</div>
</div>
<div class="section" id="delete">
<h3><a class="toc-backref" href="#id10">Delete</a><a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h3>
<p>In order to delete a snapshot, we can:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm delete MyBox:asdfölkj
[ OK ] delete snapshot MyBox:asdfölkj
</pre></div>
</div>
<p>By omitting the snapshot name, we can lay the entire VM into ashes:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm delete MyBox
Delete VM MyBox? [y/N] y
[ OK ] delete MyBox
</pre></div>
</div>
</div>
</div>
<div class="section" id="managing-vms-manually">
<h2><a class="toc-backref" href="#id11">Managing VMs Manually</a><a class="headerlink" href="#managing-vms-manually" title="Permalink to this headline">¶</a></h2>
<p>Each of the abovementioned actions can also be done without <tt class="docutils literal"><span class="pre">ctl</span></tt>, and are
rather simple. In this section, we will simply list the &#8220;manual&#8221; equivalent to
each of the commands mentioned above.</p>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id12">Create</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm create MyBox 7680M
___

$ mkdir $S2EDIR/vm/MyBox
$ $S2EDIR/build/i386-release/normal/qemu/qemu-img create -f raw $S2EDIR/vm/MyBox/disk.s2e 7680M
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id13">Clone</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm clone MyBox MyClonedBox
___

$ cp -r $S2EDIR/vm/MyBox $S2EDIR/vm/MyClonedBox
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id14">Export/Import</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm export MyBox MyBox.tar.gz
___

$ cd $S2EDIR/vm/MyBox/
$ tar czf MyBox.tar.gz disk.s2e*
$ cd -
$ mv $S2EDIR/vm/MyBox/MyBox.tar.gz .
</pre></div>
</div>
<p>and</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm import MyBox.tar.gz AnotherBox
___

$ mkdir $S2EDIR/vm/AnotherBox
$ cd $S2EDIR/vm/AnotherBox/
$ tar xzf /path/to/MyBox.tar.gz
$ cd -
</pre></div>
</div>
<p>This also reveals how VM packages are structured.</p>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id15">Delete</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm delete MyBox:asdfölkj
___

$ rm $S2EDIR/vm/MyBox/disk.s2e.asdfölkj
</pre></div>
</div>
<p>and</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm delete MyBox
___

$ rm -r $S2EDIR/vm/MyBox
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-s2e-vm-image-format">
<h2><a class="toc-backref" href="#id16">The S²E VM Image Format</a><a class="headerlink" href="#the-s2e-vm-image-format" title="Permalink to this headline">¶</a></h2>
<p><strong>Note</strong>: This section is informational. In general, you should not face the
issues described here if you are using the <tt class="docutils literal"><span class="pre">ctl</span></tt> script to interact with S²E.
However, if you are interested, the output of <tt class="docutils literal"><span class="pre">ctl</span> <span class="pre">run</span></tt> always prints the full
QEMU command line to the terminal, e.g.</p>
<div class="highlight-python"><div class="highlight"><pre>$ ctl vm run --dry-run MyBox sym
[INFO] Qemu monitor: port 12345 (connect with `{nc,telnet} XXX.XX.XX.XXX 12345)
[DEBUG] Command line:
$S2EDIR/build/i386-release-normal/qemu/i386-s2e-softmmu/qemu-system-i386 -drive file=$S2EDIR/vm/Debian/disk.s2e,cache=writeback,format=s2e -cpu pentium -monitor tcp::12345,server,nowait -net nic,model=pcnet -net user -s2e-config-file $S2EDIR/src/config/default-config.lua -s2e-verbose -s2e-output-dir $S2EDIR/expdata/auto_2015-08-19T15:06:25.383+0200
</pre></div>
</div>
<hr class="docutils" />
<p>S²E operates on raw disk images, but it treats them as being in the <em>S²E disk
image format</em>. The image handler is basically a wrapper around QEMU&#8217;s raw image
handler.</p>
<p>When in S²E mode, writes to the disk are local to each state and do not clobber
other states. Moreover, writes are NEVER propagated from the state to the image
(or the snapshot). This makes it possible to share one disk image and snapshots
among many instances of S²E.</p>
<p>S²E uses the raw format because existing disk image formats are not suitable for
multi-path execution; they usually mutate internal bookkeeping structures on
read operations, or worse, they may write these mutations back to the disk image
file, causing VM image corruptions. QCOW2 is one example of such formats. The
raw format does not suffer from any of these drawbacks, as there are no internal
disk handling mechanisms.</p>
<div class="section" id="the-s2e-file-name-suffix">
<h3><a class="toc-backref" href="#id17">The <tt class="docutils literal"><span class="pre">.s2e</span></tt> file name suffix</a><a class="headerlink" href="#the-s2e-file-name-suffix" title="Permalink to this headline">¶</a></h3>
<p>To make S²E handle a disk image with the S²E format, one can pass the
<tt class="docutils literal"><span class="pre">format=s2e</span></tt> option when specifying the disk image with QEMU&#8217;s <tt class="docutils literal"><span class="pre">-drive</span></tt>
option. If this is missing, S²E will infer the format from the file name
extension; in particular, <tt class="docutils literal"><span class="pre">.s2e</span></tt> will denote the S²E image format.</p>
<p>In practice, however, if running in symbolic mode, S²E will refuse to operate on
disk image files that do not have the <tt class="docutils literal"><span class="pre">.s2e</span></tt> extension (even if the format is
explicitly specified through <tt class="docutils literal"><span class="pre">format=s2e</span></tt>). This is to avoid data corruption
in case one forgets to specify the format.</p>
</div>
<div class="section" id="snapshots">
<h3><a class="toc-backref" href="#id18">Snapshots</a><a class="headerlink" href="#snapshots" title="Permalink to this headline">¶</a></h3>
<p>The S²E image format stores snapshots in a separate file, suffixed by the name
of the snapshot. For example, if the base image is called <tt class="docutils literal"><span class="pre">my_image.s2e</span></tt>, the
snapshot <tt class="docutils literal"><span class="pre">ready</span></tt> (generated with <tt class="docutils literal"><span class="pre">savevm</span> <span class="pre">ready</span></tt>) will be saved in the file
<tt class="docutils literal"><span class="pre">my_image.s2e.ready</span></tt> in the same folder as <tt class="docutils literal"><span class="pre">my_image.s2e</span></tt>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Managing VMs</a><ul>
<li><a class="reference internal" href="#managing-vms-with-ctl">Managing VMs With <tt class="docutils literal"><span class="pre">ctl</span></tt></a><ul>
<li><a class="reference internal" href="#create">Create</a></li>
<li><a class="reference internal" href="#clone">Clone</a></li>
<li><a class="reference internal" href="#export-import">Export/Import</a></li>
<li><a class="reference internal" href="#delete">Delete</a></li>
</ul>
</li>
<li><a class="reference internal" href="#managing-vms-manually">Managing VMs Manually</a><ul>
<li><a class="reference internal" href="#id1">Create</a></li>
<li><a class="reference internal" href="#id2">Clone</a></li>
<li><a class="reference internal" href="#id3">Export/Import</a></li>
<li><a class="reference internal" href="#id4">Delete</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-s2e-vm-image-format">The S²E VM Image Format</a><ul>
<li><a class="reference internal" href="#the-s2e-file-name-suffix">The <tt class="docutils literal"><span class="pre">.s2e</span></tt> file name suffix</a></li>
<li><a class="reference internal" href="#snapshots">Snapshots</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ManagingVMs.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="index.html">Chef 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, EPFL.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>