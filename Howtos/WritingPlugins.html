<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. How to Write an S2E plugin? &mdash; Chef 0.9 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Chef 0.9 documentation" href="../index.html" />
    <link rel="next" title="3. Parallel S2E" href="Parallel.html" />
    <link rel="prev" title="1. How to Use Execution Tracers?" href="ExecutionTracers.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Parallel.html" title="3. Parallel S2E"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ExecutionTracers.html" title="1. How to Use Execution Tracers?"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Chef 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="how-to-write-an-s2e-plugin">
<h1>2. How to Write an S2E plugin?<a class="headerlink" href="#how-to-write-an-s2e-plugin" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we show step-by-step how to write a complete plugin that uses most of the features of the S2E plugin infrastructure.
We take the example of a plugin that counts how many times a specific instruction has been executed.
Users of that plugin can specify the instruction to watch in the S2E configuration file.
We will also show how to build the plugin so that it can communicate with other plugins and expose
reusable functionality.</p>
<div class="section" id="starting-with-an-empty-plugin">
<h2>2.1. Starting with an Empty Plugin<a class="headerlink" href="#starting-with-an-empty-plugin" title="Permalink to this headline">¶</a></h2>
<p>The first thing to do is to name the plugin and create boilerplate code. Let us name the plugin <tt class="docutils literal"><span class="pre">InstructionTracker</span></tt>.
You can copy/paste the <tt class="docutils literal"><span class="pre">Example</span></tt> plugin that ships with S2E.</p>
<p>Create a file named <tt class="docutils literal"><span class="pre">InstructionTracker.h</span></tt> in the <tt class="docutils literal"><span class="pre">/qemu/s2e/Plugins</span></tt> directory with the following content:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#ifndef S2E_PLUGINS_INSTRTRACKER_H</span>
<span class="cp">#define S2E_PLUGINS_INSTRTRACKER_H</span>

<span class="cp">#include &lt;s2e/Plugin.h&gt;</span>
<span class="cp">#include &lt;s2e/Plugins/CorePlugin.h&gt;</span>
<span class="cp">#include &lt;s2e/S2EExecutionState.h&gt;</span>

<span class="n">namespace</span> <span class="n">s2e</span> <span class="p">{</span>
<span class="n">namespace</span> <span class="n">plugins</span> <span class="p">{</span>

<span class="n">class</span> <span class="n">InstructionTracker</span> <span class="o">:</span> <span class="n">public</span> <span class="n">Plugin</span>
<span class="p">{</span>
    <span class="n">S2E_PLUGIN</span>
<span class="nl">public:</span>
    <span class="n">InstructionTracker</span><span class="p">(</span><span class="n">S2E</span> <span class="o">*</span><span class="n">s2e</span><span class="p">)</span><span class="o">:</span> <span class="n">Plugin</span><span class="p">(</span><span class="n">s2e</span><span class="p">)</span> <span class="p">{}</span>

    <span class="kt">void</span> <span class="n">initialize</span><span class="p">();</span>
<span class="p">};</span>

<span class="p">}</span> <span class="c1">// namespace plugins</span>
<span class="p">}</span> <span class="c1">// namespace s2e</span>

<span class="cp">#endif</span>
</pre></div>
</div>
<p>Then, create the corresponding <tt class="docutils literal"><span class="pre">InstructionTracker.cpp</span></tt> file in the same directory as follows:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include &lt;s2e/S2E.h&gt;</span>
<span class="cp">#include &quot;InstructionTracker.h&quot;</span>

<span class="n">namespace</span> <span class="n">s2e</span> <span class="p">{</span>
<span class="n">namespace</span> <span class="n">plugins</span> <span class="p">{</span>

<span class="c1">//Define a plugin whose class is InstructionTracker and called &quot;InstructionTracker&quot;.</span>
<span class="c1">//The plugin does not have any dependency.</span>
<span class="n">S2E_DEFINE_PLUGIN</span><span class="p">(</span><span class="n">InstructionTracker</span><span class="p">,</span> <span class="s">&quot;Tutorial - Tracking instructions&quot;</span><span class="p">,</span> <span class="s">&quot;InstructionTracker&quot;</span><span class="p">,);</span>

<span class="kt">void</span> <span class="n">InstructionTracker</span><span class="o">::</span><span class="n">initialize</span><span class="p">()</span>
<span class="p">{</span>

<span class="p">}</span>

<span class="p">}</span> <span class="c1">// namespace plugins</span>
<span class="p">}</span> <span class="c1">// namespace s2e</span>
</pre></div>
</div>
<p>Finally, we need  to compile the plugin with the rest of S2E.
For this, add the following line to <tt class="docutils literal"><span class="pre">/qemu/Makefile.target</span></tt>, near other plugin declarations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">s2eobj</span><span class="o">-</span><span class="n">y</span> <span class="o">+=</span> <span class="n">s2e</span><span class="o">/</span><span class="n">Plugins</span><span class="o">/</span><span class="n">InstructionTracker</span><span class="o">.</span><span class="n">o</span>
<span class="c">#...many more lines here...</span>
<span class="n">s2eobj</span><span class="o">-</span><span class="n">y</span> <span class="o">+=</span> <span class="n">s2e</span><span class="o">/</span><span class="n">Plugins</span><span class="o">/</span><span class="n">ExecutionTracers</span><span class="o">/</span><span class="n">ExecutionTracer</span><span class="o">.</span><span class="n">o</span>
<span class="n">s2eobj</span><span class="o">-</span><span class="n">y</span> <span class="o">+=</span> <span class="n">s2e</span><span class="o">/</span><span class="n">Plugins</span><span class="o">/</span><span class="n">ExecutionTracers</span><span class="o">/</span><span class="n">ModuleTracer</span><span class="o">.</span><span class="n">o</span>
<span class="n">s2eobj</span><span class="o">-</span><span class="n">y</span> <span class="o">+=</span> <span class="n">s2e</span><span class="o">/</span><span class="n">Plugins</span><span class="o">/</span><span class="n">ExecutionTracers</span><span class="o">/</span><span class="n">EventTracer</span><span class="o">.</span><span class="n">o</span>
</pre></div>
</div>
</div>
<div class="section" id="reading-configuration-parameters">
<h2>2.2. Reading Configuration Parameters<a class="headerlink" href="#reading-configuration-parameters" title="Permalink to this headline">¶</a></h2>
<p>We would like to let the user specify which instruction to monitor. For this, we create a configuration variable
that stores the address of that instruction.
Every plugin can have an entry in the S2E configuration file. The entry for our plugin would look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>pluginsConfig.InstructionTracker = {
    -- The address we want to track
    addressToTrack=0x12345
}
</pre></div>
</div>
<p>If we run the plugin as it is now, nothing will happen. S2E ignores any unknown configuration value.
We need a mechanism to explicitly retrieve the configuration value.
In S2E, plugins can retrieve the configuration at any time. In our case, we do it during the initialization phase.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="c1">//We need this to read configuration files</span>
<span class="cp">#include &lt;s2e/ConfigFile.h&gt;</span>
<span class="c1">//...</span>

<span class="kt">void</span> <span class="n">InstructionTracker</span><span class="o">::</span><span class="n">initialize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">m_address</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">s2e</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getConfig</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getInt</span><span class="p">(</span><span class="n">getConfigKey</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;.addressToTrack&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Do not forget to add <tt class="docutils literal"><span class="pre">uint64_t</span> <span class="pre">m_address;</span></tt> to the private members of class <tt class="docutils literal"><span class="pre">InstructionTracker</span></tt>
in <tt class="docutils literal"><span class="pre">InstructionTracker.h</span></tt>.</p>
</div>
<div class="section" id="instrumenting-instructions">
<h2>2.3. Instrumenting Instructions<a class="headerlink" href="#instrumenting-instructions" title="Permalink to this headline">¶</a></h2>
<p>To instrument an instruction, an S2E plugins registers to the <tt class="docutils literal"><span class="pre">onTranslateInstructionStart</span></tt>  core event.
There are many other core events to which a plugin can register. These events are defined in  <tt class="docutils literal"><span class="pre">CorePlugin.h</span></tt>.</p>
<p>Extend your code as follows. Do not forget to add all new member functions to the (private) section of the class declaration.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">void</span> <span class="n">InstructionTracker</span><span class="o">::</span><span class="n">initialize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">m_address</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span> <span class="n">s2e</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getConfig</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getInt</span><span class="p">(</span><span class="n">getConfigKey</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;.addressToTrack&quot;</span><span class="p">);</span>

    <span class="c1">//This indicates that our plugin is interested in monitoring instruction translation.</span>
    <span class="c1">//For this, the plugin registers a callback with the onTranslateInstruction signal.</span>
    <span class="n">s2e</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getCorePlugin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">onTranslateInstructionStart</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">sigc</span><span class="o">::</span><span class="n">mem_fun</span><span class="p">(</span><span class="o">*</span><span class="n">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">InstructionTracker</span><span class="o">::</span><span class="n">onTranslateInstruction</span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">InstructionTracker</span><span class="o">::</span><span class="n">onTranslateInstruction</span><span class="p">(</span><span class="n">ExecutionSignal</span> <span class="o">*</span><span class="n">signal</span><span class="p">,</span>
                                                <span class="n">S2EExecutionState</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span>
                                                <span class="n">TranslationBlock</span> <span class="o">*</span><span class="n">tb</span><span class="p">,</span>
                                                <span class="kt">uint64_t</span> <span class="n">pc</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">m_address</span> <span class="o">==</span> <span class="n">pc</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//When we find an interesting address, ask S2E to invoke our</span>
        <span class="c1">//callback when the address is actually executed.</span>
        <span class="n">signal</span><span class="o">-&gt;</span><span class="n">connect</span><span class="p">(</span><span class="n">sigc</span><span class="o">::</span><span class="n">mem_fun</span><span class="p">(</span><span class="o">*</span><span class="n">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">InstructionTracker</span><span class="o">::</span><span class="n">onInstructionExecution</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//This callback is called only when the instruction at our address is executed.</span>
<span class="c1">//The callback incurs zero overhead for all other instructions.</span>
<span class="kt">void</span> <span class="n">InstructionTracker</span><span class="o">::</span><span class="n">onInstructionExecution</span><span class="p">(</span><span class="n">S2EExecutionState</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">pc</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">s2e</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getDebugStream</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Executing instruction at &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">hexval</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="c1">//The plugins can arbitrarily modify/observe the current execution state via</span>
    <span class="c1">//the execution state pointer.</span>
    <span class="c1">//Plugins can also call the s2e() method to use the S2E API.</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="counting-instructions">
<h2>2.4. Counting Instructions<a class="headerlink" href="#counting-instructions" title="Permalink to this headline">¶</a></h2>
<p>We would like to count how many times that particular instruction is executed.
There are two options:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Count how many times it was executed across all paths.</li>
<li>Count how many times it was executed in each path.</li>
</ol>
</div></blockquote>
<p>The first option is trivial to implement. Simply add an additional member
to the class and increment it every time the <tt class="docutils literal"><span class="pre">onInstructionExecution</span></tt> callback is invoked.</p>
<p>The second option requires to keep per-state plugin information.
S2E plugins manage per-state information in a class that derives from <tt class="docutils literal"><span class="pre">PluginState</span></tt>.
This class must implement a factory method that returns a new instance of the class when S2E starts symbolic execution.
It  must also implement a <tt class="docutils literal"><span class="pre">clone</span></tt> method which S2E uses to fork the plugin state.</p>
<p>Here is how <tt class="docutils literal"><span class="pre">InstructionTracker</span></tt> could implement the plugin state.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">class</span> <span class="n">InstructionTrackerState</span><span class="o">:</span> <span class="n">public</span> <span class="n">PluginState</span>
<span class="p">{</span>
<span class="nl">private:</span>
    <span class="kt">int</span> <span class="n">m_count</span><span class="p">;</span>

<span class="nl">public:</span>
    <span class="n">InstructionTrackerState</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">m_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">~</span><span class="n">InstructionTrackerState</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">static</span> <span class="n">PluginState</span> <span class="o">*</span><span class="n">factory</span><span class="p">(</span><span class="n">Plugin</span><span class="o">*</span><span class="p">,</span> <span class="n">S2EExecutionState</span><span class="o">*</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">new</span> <span class="n">InstructionTrackerState</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">InstructionTrackerState</span> <span class="o">*</span><span class="n">clone</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">new</span> <span class="n">InstructionTrackerState</span><span class="p">(</span><span class="o">*</span><span class="n">this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">increment</span><span class="p">()</span> <span class="p">{</span> <span class="o">++</span><span class="n">m_count</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">int</span> <span class="n">get</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_count</span><span class="p">;</span> <span class="p">}</span>

<span class="p">};</span>
</pre></div>
</div>
<p>Plugin code can refer to this state using the <tt class="docutils literal"><span class="pre">DECLARE_PLUGINSTATE</span></tt> macro, like this:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">void</span> <span class="n">InstructionTracker</span><span class="o">::</span><span class="n">onInstructionExecution</span><span class="p">(</span><span class="n">S2EExecutionState</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">pc</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//This macro declares the plgState variable of type InstructionTrackerState.</span>
    <span class="c1">//It automatically takes care of retrieving the right plugin state attached to the</span>
    <span class="c1">//specified execution state.</span>
    <span class="n">DECLARE_PLUGINSTATE</span><span class="p">(</span><span class="n">InstructionTrackerState</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>

    <span class="n">s2e</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getDebugStream</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Executing instruction at &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">hexval</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="c1">//Increment the count</span>
    <span class="n">plgState</span><span class="o">-&gt;</span><span class="n">increment</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="exporting-events">
<h2>2.5. Exporting Events<a class="headerlink" href="#exporting-events" title="Permalink to this headline">¶</a></h2>
<p>All S2E plugins can define custom events. Other plugins can in turn connect to them and also export
their own events. This scheme is heavily used by stock S2E plugins. For example, S2E provides the <tt class="docutils literal"><span class="pre">Annotation</span></tt> plugin that
invokes a user-written script that can arbitrarily manipulate the execution state.
This plugin allows to implement different execution consistency models
and is a central piece in tools like DDT and RevNIC. This plugins relies on <tt class="docutils literal"><span class="pre">FunctionMonitor</span></tt> to intercept annotated functions and
on <tt class="docutils literal"><span class="pre">ModuleExecutionDetector</span></tt> to trigger annotations when execution enters user-defined modules. Finally, <tt class="docutils literal"><span class="pre">ModuleExecutionDetector</span></tt>
itself depends on several plugins that abstract OS-specific events (e.g., module loads/unloads).</p>
<p>In this tutorial, we show how <tt class="docutils literal"><span class="pre">InstructionTracker</span></tt> can expose an event and trigger it when the monitored instruction
is executed ten times.</p>
<p>First, we declare the signal as a <tt class="docutils literal"><span class="pre">public</span></tt> field of the <tt class="docutils literal"><span class="pre">InstructionTracker</span></tt> class. It is important that the field be public,
otherwise other plugins will not be able to register.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">class</span> <span class="n">InstructionTracker</span><span class="o">:</span> <span class="n">public</span> <span class="n">Plugin</span> <span class="p">{</span>
    <span class="c1">//...</span>

    <span class="nl">public:</span>
        <span class="n">sigc</span><span class="o">::</span><span class="n">signal</span><span class="o">&lt;</span>
            <span class="kt">void</span><span class="p">,</span>
            <span class="n">S2EExecutionState</span> <span class="o">*</span><span class="p">,</span> <span class="c1">//The first parameter of the callback is the state</span>
            <span class="kt">uint64_t</span>             <span class="c1">//The second parameter is an integer representing the program counter</span>
            <span class="o">&gt;</span> <span class="n">onPeriodicEvent</span><span class="p">;</span>

    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Second, we add some logic to fire the event and call all the registered callbacks.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">void</span> <span class="n">InstructionTracker</span><span class="o">::</span><span class="n">onInstructionExecution</span><span class="p">(</span><span class="n">S2EExecutionState</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">pc</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DECLARE_PLUGINSTATE</span><span class="p">(</span><span class="n">InstructionTrackerState</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>

    <span class="n">s2e</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getDebugStream</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Executing instruction at &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">hexval</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

    <span class="n">plgState</span><span class="o">-&gt;</span><span class="n">increment</span><span class="p">();</span>

    <span class="c1">//Fire the event</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">plgState</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">()</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">onPeriodicEvent</span><span class="p">.</span><span class="n">emit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">pc</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>That is all we need to define and trigger an event.
To register for this event, a plugin invokes <tt class="docutils literal"><span class="pre">s2e()-&gt;getPlugin(&quot;PluginName&quot;);</span></tt>, where <tt class="docutils literal"><span class="pre">PluginName</span></tt> is
the name of the plugin as defined in the <tt class="docutils literal"><span class="pre">S2E_DEFINE_PLUGIN</span></tt> macro.
In our case, a plugin named <tt class="docutils literal"><span class="pre">MyClient</span></tt> would do something like this in its initialization routine:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="c1">//Specify dependencies</span>
<span class="n">S2E_DEFINE_PLUGIN</span><span class="p">(</span><span class="n">MyClient</span><span class="p">,</span> <span class="s">&quot;We use InstructionTracker&quot;</span><span class="p">,</span> <span class="s">&quot;MyClient&quot;</span><span class="p">,</span> <span class="s">&quot;InstructionTracker&quot;</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">MyClient</span><span class="o">::</span><span class="n">initialize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//Get the instance of the plugin</span>
    <span class="n">InstructionTracker</span> <span class="o">*</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="n">InstructionTracker</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">s2e</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getPlugin</span><span class="p">(</span><span class="s">&quot;InstructionTracker&quot;</span><span class="p">));</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">tracker</span><span class="p">);</span>

    <span class="c1">//Register to custom events</span>
    <span class="n">tracker</span><span class="o">-&gt;</span><span class="n">onPeriodicEvent</span><span class="p">...</span>

    <span class="c1">//Call plugin&#39;s public members</span>
    <span class="n">tracker</span><span class="o">-&gt;</span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that S2E enforces the plugin dependencies specified in the <tt class="docutils literal"><span class="pre">S2E_DEFINE_PLUGIN</span></tt> macro.
If a dependency is not satisfied (e.g., the plugin is not enabled in the configuration file or
is not compiled in S2E), S2E will not start and emit an error message instead.</p>
<p>It is not always necessary to specify the dependencies.
For example, a plugin may want to work with reduced functionality if some dependent plugin is missing.
Attempting to call <tt class="docutils literal"><span class="pre">s2e()-&gt;getPlugin()</span></tt>  returns <tt class="docutils literal"><span class="pre">NULL</span></tt> if the requested plugin is missing.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. How to Write an S2E plugin?</a><ul>
<li><a class="reference internal" href="#starting-with-an-empty-plugin">2.1. Starting with an Empty Plugin</a></li>
<li><a class="reference internal" href="#reading-configuration-parameters">2.2. Reading Configuration Parameters</a></li>
<li><a class="reference internal" href="#instrumenting-instructions">2.3. Instrumenting Instructions</a></li>
<li><a class="reference internal" href="#counting-instructions">2.4. Counting Instructions</a></li>
<li><a class="reference internal" href="#exporting-events">2.5. Exporting Events</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ExecutionTracers.html"
                        title="previous chapter">1. How to Use Execution Tracers?</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Parallel.html"
                        title="next chapter">3. Parallel S2E</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/Howtos/WritingPlugins.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Parallel.html" title="3. Parallel S2E"
             >next</a> |</li>
        <li class="right" >
          <a href="ExecutionTracers.html" title="1. How to Use Execution Tracers?"
             >previous</a> |</li>
        <li><a href="../index.html">Chef 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, EPFL.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>