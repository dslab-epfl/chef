<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. Setting Up the Checked Build of Windows &mdash; Chef 0.9 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Chef 0.9 documentation" href="../index.html" />
    <link rel="next" title="1. Compiling the Linux Kernel" href="../BuildingLinux.html" />
    <link rel="prev" title="1. Analyzing Windows Drivers: Step-by-Step Tutorial" href="DriverTutorial.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../BuildingLinux.html" title="1. Compiling the Linux Kernel"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="DriverTutorial.html" title="1. Analyzing Windows Drivers: Step-by-Step Tutorial"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Chef 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="setting-up-the-checked-build-of-windows">
<h1>2. Setting Up the Checked Build of Windows<a class="headerlink" href="#setting-up-the-checked-build-of-windows" title="Permalink to this headline">Â¶</a></h1>
<p>The checked build of Windows is a version that is compiled with more checks and debugging information.
It catches bugs earlier, before they propagate through the system and cause non-informative blue screens.
<em>You do not need the checked build for normal S2E use.</em></p>
<p>It is not necessary to install the entire checked version of Windows.
It is sufficient to replace the kernel image and the HAL with a checked version, while leaving the rest as is (i.e., in the &#8220;Free Build&#8221; state).</p>
<p>The following is an excerpt from an article available <a class="reference external" href="http://www.osronline.com/article.cfm?id=405">here</a>,
and details the process of replacing various system files with their checked counterparts.</p>
<p>First, download the following file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">WindowsXP</span><span class="o">-</span><span class="n">KB936929</span><span class="o">-</span><span class="n">SP3</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="n">symbols</span><span class="o">-</span><span class="n">full</span><span class="o">-</span><span class="n">ENU</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
<p>It contains the checked version of Windows Service Pack 3. You must have the free build of SP3 already up and running.</p>
<p>To install the &#8220;partially checked&#8221; build, you want just the operating system image and the HAL image. You will need to extract these images from the files you downloaded. For this, run the downloaded executable and take not of the place where it extracts the files. The process will fail with an error message, stating an incompatibility with the currently installed version. Before closing the window, copy the extract files to a new place. Once you close the window, the installer will erase the original files.</p>
<p>Extract the <em>hal*.dl_</em> and <em>nt*.dl_</em> files that are located in <em>\i386</em>, using the <em>expand</em> utility. Replace the extension of the files with <em>.chk</em>. Copy them to the <em>system32</em> folder of the target system.</p>
<p>This gives you ALL the HALs and operating system images. To figure out which version of the files we need to use on our target system, open the following file on your target system:</p>
<div class="highlight-python"><div class="highlight"><pre>%SystemRoot%\repair\setup.log
</pre></div>
</div>
<p>In this file, you will see which operating system image and HAL were used during the original installation of the system.  For example, you may have:</p>
<div class="highlight-python"><div class="highlight"><pre>\WINDOWS\system32\hal.dll = &quot;halmacpi.dll&quot;,&quot;2242b&quot;
\WINDOWS\system32\ntkrnlpa.exe = &quot;ntkrpamp.exe&quot;,&quot;1daa3e&quot;
\WINDOWS\system32\ntoskrnl.exe = &quot;ntkrnlmp.exe&quot;,&quot;1d3970&quot;
</pre></div>
</div>
<p>This is telling us that we need <em>halmacpi.dll</em>,  <em>ntkrpamp.exe</em>, and <em>ntkrnlmp.exe</em> for this system. Note that if you do not have <em>pa</em> extensions, or if you do not use <em>/PAE</em> to boot, you would use the version of NT kernel without the <em>pa</em> in it.</p>
<p>Finally, modify <em>boot.ini</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>multi(0)disk(0)rdisk(0)partition(1)\WINNT=&quot;Windows MyOS Checked&quot; /fastdetect /kernel=ntkrnlmp.chk /hal=halacpi.chk
</pre></div>
</div>
<p>You must replace other system files with their checked versions in <strong>safe mode</strong>. Replacing them in normal mode will trigger the Windows File Protection mechanism, restoring the original file.</p>
<p>Your S2E configuration file should have the following section:</p>
<div class="highlight-python"><div class="highlight"><pre>pluginsConfig.WindowsMonitor = {
  version=&quot;XPSP3-CHK&quot;,
  userMode=true,
  kernelMode=true,
  monitorModuleLoad=true,
  monitorModuleUnload=true,
  monitorProcessUnload=true
}
</pre></div>
</div>
<p>The <a class="reference external" href="../Plugins/WindowsInterceptor/WindowsMonitor.html">WindowsMonitor</a> plugin has <strong>only</strong> support for the checked version of ntoskrnlpa.exe for now!</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="DriverTutorial.html"
                        title="previous chapter">1. Analyzing Windows Drivers: Step-by-Step Tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../BuildingLinux.html"
                        title="next chapter">1. Compiling the Linux Kernel</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/Windows/CheckedBuild.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../BuildingLinux.html" title="1. Compiling the Linux Kernel"
             >next</a> |</li>
        <li class="right" >
          <a href="DriverTutorial.html" title="1. Analyzing Windows Drivers: Step-by-Step Tutorial"
             >previous</a> |</li>
        <li><a href="../index.html">Chef 0.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, EPFL.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>